---
import type { RecRow } from "../data/recommnedations";

export interface Props {
  title: string;
  rows: RecRow[];
}

// helpers
const fmtNum = (n: number) =>
  new Intl.NumberFormat("en-US", { minimumFractionDigits: 2, maximumFractionDigits: 2 }).format(n);

const fmtDate = (iso: string) =>
  new Intl.DateTimeFormat("en-GB", { day: "2-digit", month: "short", year: "2-digit" }).format(new Date(iso));

const pct = (entry: number, current: number) => (current / entry - 1) * 100;

const computed = Astro.props.rows.map(r => {
  const p = pct(r.entryPrice, r.currentPrice);
  return {
    ...r,
    entryDateFmt: fmtDate(r.entryDate),
    entryPriceFmt: fmtNum(r.entryPrice),
    currentPriceFmt: fmtNum(r.currentPrice),
    pct: p,
    pctFmt: `${p >= 0 ? "" : ""}${p.toFixed(1)}%`,
    cls: p >= 0 ? "pos" : "neg",
  };
});
---
<section class="wrap">
  <h1 class="title">{Astro.props.title}</h1>

  <div class="table-container" role="region" aria-labelledby="tableCaption">
    <table class="table">
      <caption id="tableCaption" class="sr-only">{Astro.props.title}</caption>
      <thead>
        <tr>
          <th>Core Trade Recommendations</th>
          <th>Entry Date</th>
          <th>Entry Price</th>
          <th>% Since Inception</th>
          <th>Current Price</th>
        </tr>
      </thead>
      <tbody>
        {computed.map((r) => (
          <tr>
            <td class="asset">{r.asset}</td>
            <td>{r.entryDateFmt}</td>
            <td>{r.entryPriceFmt}</td>
            <td class={`pct ${r.cls}`}>{r.pctFmt}</td>
            <td>{r.currentPriceFmt}</td>
          </tr>
        ))}
      </tbody>
    </table>
  </div>
</section>

<style>
  .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}

  .wrap{
    max-width: 1100px;
    margin: 4rem auto;
    padding: 1rem;
  }
  .title{
    margin: 0 0 1rem;
    text-align: center;
    font-size: clamp(2rem, 3vw, 3rem);
    color: var(--accent);
    font-weight: 800;
    letter-spacing: 0.4px;
  }

  .table-container{
    background: #2a2a2a;
    border-radius: 28px;
    padding: 1.25rem;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    box-shadow: 0 0 0 1px rgba(255,255,255,0.04) inset;
  }

  .table{
    width: 100%;
    border-collapse: collapse;
    min-width: 760px;
    color: var(--text);
  }

  thead th{
    text-align: left;
    padding: 14px 16px;
    background: #a69463;           /* gold bar */
    color: #111;
    font-weight: 700;
    border-bottom: 2px solid #6c6241;
  }

  tbody td{
    padding: 16px;
    border-bottom: 1px solid #333;
    background: #141414;           /* row base */
  }
  tbody tr:nth-child(2n) td{
    background: #191919;           /* subtle zebra */
  }

  .asset{font-weight:600}
  .pct.pos{color:#1ca13a;font-weight:700}
  .pct.neg{color:#d14;font-weight:700}
</style>
